@using System.Text.Json
@inject HubClientService HubClientService
<MudDialog DisableSidePadding="true"
    ClassContent="pt-0">
  <DialogContent>
    <MudListSubheaderExtended T="string"
        SecondaryBackground="true"
        Class="mud-width-full"
        DisableGutters="true">
      <MudText Align="Align.Center"
          Typo="Typo.h6">
        @WindingCode.Division : @WindingCode.Code - @WindingCode.Id
      </MudText>
    </MudListSubheaderExtended>
    <MudStack Row
        Spacing="2"
        Justify="Justify.Center"
        AlignItems="AlignItems.Center">

      <MudRadioGroup @bind-SelectedOption="SelectedWindingCode">
        @foreach (var windingCode in WindingCodesForImport) {
          <MudRadio Option="windingCode"
              Color="Color.Secondary"
              UnCheckedColor="Color.Info">
            @windingCode.Division
          </MudRadio>
        }
      </MudRadioGroup>
    </MudStack>
  </DialogContent>
  <DialogActions>
    <MudButton OnClick="Cancel">Cancel</MudButton>
    <MudButton Color="@Color"
        Variant="Variant.Filled"
        OnClick="Submit">
      @ButtonText
    </MudButton>
  </DialogActions>
</MudDialog>

@code {
  [CascadingParameter]
  public required MudDialogInstance MudDialog { get; set; }
  [Parameter]
  public required WindingCode WindingCode { get; set; }
  [Parameter]
  public string ContentText { get; set; } = "Select Division to import data from";
  [Parameter]
  public string ButtonText { get; set; } = "Import Data";
  [Parameter]
  public Color Color { get; set; } = Color.Info;

  private WindingCode? SelectedWindingCode { get; set; }

  private List<WindingCode> WindingCodesForImport { get; set; } = new();
  void Submit() {
  // transfer the SelectedWindingCode.[FolderPath, Media] to WindingCode.[FolderPath, Media]
  // and return the WindingCode to the parent component
    Console.WriteLine($"Original WindingCode: {JsonSerializer.Serialize(WindingCode)}");
    if (SelectedWindingCode is null) {
      Cancel();
      return;
    }
    Console.WriteLine($"Selected WindingCode: {JsonSerializer.Serialize(SelectedWindingCode)}");

  // compare the selected WindingCode to the original WindingCode
  // code.FolderPath, code.Media.Pdf, code.Media.video, code.Media.refMedia should be evaluated
    var tempWindingCode = WindingCode.Clone();
    tempWindingCode.Id = SelectedWindingCode.Id;
    tempWindingCode.Division = SelectedWindingCode.Division;

    var original = JsonSerializer.Serialize(tempWindingCode);
    var selected = JsonSerializer.Serialize(SelectedWindingCode);

    if (original.Equals(selected)) {
      Console.WriteLine("Selected WindingCode is the same as the original WindingCode");
      Cancel();
      return;
    }

    WindingCode.FolderPath = SelectedWindingCode.FolderPath;
    WindingCode.Media = SelectedWindingCode.Media;
    Console.WriteLine($"Updated WindingCode: {JsonSerializer.Serialize(WindingCode)}");
    MudDialog.Close(DialogResult.Ok(WindingCode));
  }
  void Cancel() => MudDialog.Cancel();

  protected override async Task OnInitializedAsync() {
    await base.OnInitializedAsync();
    WindingCodesForImport = await HubClientService.GetWindingCodesForImport(WindingCode);
  }
}
